# 拼音转换器 - 工具使用手册

## 工具概览

本项目提供了丰富的工具集，用于辅助拼音转换、字典管理和数据处理。

## 1. 统一任务运行器 (bin/task_runner.php)

### 功能描述
这是一个功能完整的后台任务处理系统，支持多种运行模式和信号控制。

### 使用方式

```bash
# 显示帮助信息
php bin/task_runner.php -h

# 守护进程模式（推荐生产环境）
php bin/task_runner.php -m daemon -i 60

# 批量处理模式
php bin/task_runner.php -m batch -b 100 -l 500

# 一次性执行模式
php bin/task_runner.php -m once
```

### 信号控制（守护进程模式下）
```bash
# 优雅关闭进程
kill -TERM $(cat /tmp/pinyin_task_daemon.pid)

# 优雅重启
kill -HUP $(cat /tmp/pinyin_task_daemon.pid)

# 重新加载配置
kill -USR2 $(cat /tmp/pinyin_task_daemon.pid)
```

### 定时任务配置
```bash
# 每天凌晨2点执行字典合并
0 2 * * * /usr/bin/php /path/to/bin/task_runner.php -m once >> /var/log/pinyin_task.log 2>&1

# 每5分钟检查任务
*/5 * * * * /usr/bin/php /path/to/bin/task_runner.php -m batch -b 10 >> /var/log/pinyin_task.log 2>&1
```

## 2. 自动拼音获取工具 (tools/pinyin_auto_fetch.php)

### 功能描述
专门为未找到拼音的汉字获取真实拼音，并保存到待确认文件。

### 使用方式
```php
// 使用示例
$fetcher = new PinyinAutoFetcher();
$pinyin = $fetcher->getPinyinFromBaidu('𠮷');
```

### 支持的API
- 百度拼音API
- 其他在线拼音服务

## 3. 拼音解析工具 (tools/pinyin_resolver.php)

### 功能描述
解析和处理拼音数据，支持多音字识别和拼音标准化。

### 使用方式
```php
// 解析拼音字符串
$resolver = new PinyinResolver();
$result = $resolver->parse('ni3 hao3 shi4 jie4');
```

## 4. 手动拼音辅助工具 (tools/pinyin_manual_helper.php)

### 功能描述
辅助手动处理生僻字拼音，提供查询和验证功能。

### 使用方式
```php
// 查询汉字拼音
$helper = new PinyinManualHelper();
$info = $helper->queryCharacter('𠮷');
```

## 5. 快速测试工具 (tools/quick_pinyin_test.php)

### 功能描述
快速测试拼音转换功能，支持批量测试和结果验证。

### 使用方式
```bash
# 运行测试
php tools/quick_pinyin_test.php

# 测试特定文本
php tools/quick_pinyin_test.php "你好世界"
```

## 6. Unihan数据管理工具 (unicode/)

### 核心工具

#### 6.1 Unihan数据管理器 (UnihanDataManager.php)
```php
use tekintian\pinyin\unicode\UnihanDataManager;

$manager = new UnihanDataManager();

// 更新数据
$updated = $manager->updateData();

// 生成报告
$report = $manager->generateReport();
```

#### 6.2 数据提取器 (UnihanExtractor.php)
```php
// 提取拼音数据
$extractor = new UnihanExtractor();
$pinyinData = $extractor->extractPinyinData();
```

#### 6.3 数据对比器 (UnihanComparator.php)
```php
// 对比字典数据
$comparator = new UnihanComparator();
$diff = $comparator->compareWithCurrentDict();
```

### 使用示例

#### 完整的数据更新流程
```php
<?php
require_once 'UnihanDataManager.php';

use tekintian\pinyin\unicode\UnihanDataManager;

$manager = new UnihanDataManager();

// 1. 检查并更新数据
if ($manager->updateData()) {
    echo "数据更新成功\\n";
}

// 2. 生成详细报告
$report = $manager->generateReport();
echo $report;

// 3. 获取对比结果
$comparison = $manager->compareWithCurrentDict();
print_r($comparison);
```

#### 批量处理脚本
```php
// 批量处理Unihan数据
$extractor = new UnihanExtractor();

// 按区块提取数据
$blocks = ['cjk_basic', 'cjk_ext_a', 'cjk_ext_b'];
foreach ($blocks as $block) {
    $data = $extractor->extractByBlock($block);
    $extractor->saveToFile($data, "data/unihan/{$block}.php");
}
```

## 7. 字典管理工具

### 字典合并工具
```php
// 执行字典合并
$converter = new PinyinConverter();
$result = $converter->executeMerge();
```

### 字典验证工具
```php
// 验证字典完整性
$validator = new DictValidator();
$validation = $validator->validateAllDicts();
```

## 8. 性能测试工具

### 内存使用测试
```php
// 测试内存使用
$tester = new PerformanceTester();
$memoryUsage = $tester->testMemoryUsage('你好世界');
```

### 转换速度测试
```php
// 测试转换速度
$speed = $tester->testConversionSpeed('这是一个测试文本', 1000);
```

## 9. 调试工具

### 调试模式启用
```php
// 启用详细调试
$converter = new PinyinConverter([
    'debug' => true,
    'log_level' => 'verbose'
]);
```

### 日志分析工具
```php
// 分析运行日志
$analyzer = new LogAnalyzer();
$stats = $analyzer->analyzeTaskLogs('/var/log/pinyin_task.log');
```

## 工具集成示例

### 完整的处理流程
```bash
#!/bin/bash

# 1. 启动后台任务守护进程
php bin/task_runner.php -m daemon -i 60 &

# 2. 执行Unihan数据更新
php unicode/extract_unihan.php

# 3. 运行拼音测试
php tools/quick_pinyin_test.php

# 4. 生成项目报告
php tools/generate_report.php
```

### 自动化部署脚本
```bash
#!/bin/bash

# 部署脚本示例
echo "开始部署拼音转换器..."

# 安装依赖
composer install

# 配置定时任务
crontab -l | grep -v "pinyin" | crontab -
echo "0 2 * * * /usr/bin/php $(pwd)/bin/task_runner.php -m once >> /var/log/pinyin_task.log 2>&1" | crontab -

# 启动服务
php bin/task_runner.php -m daemon -i 60 &

echo "部署完成！"
```

## 故障排除

### 常见问题解决

1. **工具无法执行**
   ```bash
   # 检查PHP版本
   php -v
   
   # 检查文件权限
   chmod +x bin/task_runner.php
   ```

2. **内存不足错误**
   ```bash
   # 增加PHP内存限制
   php -d memory_limit=512M bin/task_runner.php
   ```

3. **字典文件找不到**
   ```php
   // 检查文件路径
   var_dump(file_exists('/path/to/dict.php'));
   ```

### 调试技巧

1. **启用详细日志**
   ```php
   // 在工具中启用调试
   define('PINYIN_DEBUG', true);
   ```

2. **性能监控**
   ```bash
   # 监控内存使用
   while true; do ps aux | grep task_runner | grep -v grep; sleep 5; done
   ```

---

**工具版本**: 1.0.0  
**最后更新**: 2025-11-16  
**维护者**: tekintian